# **2-04 엔티티로 테이블 매핑하기**

## DB 구성 요소

- table, row, column
- primary key: 테이블의 데이터가 중복되어 저장되지 않게 한다. 어떤 열을 기본키로 설정하면 해당 열에는 동일한 값을 저장하지 못한다.

## Entity 속성 구성하기

- Entity(모델, 도메인 모델): 데이터베이스 테이블과 매핑되는 자바 클래스

```java

@Entity
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Review extends BaseTimeEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "guest_id", nullable = false)
    private User guest;

    @ManyToOne
    @JoinColumn(name = "space_id", nullable = false)
    private Space space;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "reservation_id", nullable = false)
    private Reservation reservation;

    private int rating; // 별점 (1~5)

    @Column(length = 1000)
    private String content;

    private LocalDate reservedDate;

    @OneToOne(mappedBy = "review", cascade = CascadeType.ALL, orphanRemoval = true)
    private ReviewComment comment;

    @OneToMany(mappedBy = "review", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ReviewImage> images = new ArrayList<>();

		// 생략
}

@Entity
@Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ReviewComment extends BaseTimeEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @OneToOne
    @JoinColumn(name = "review_id", nullable = false)
    private Review review;

    @Column(length = 500)
    private String content;

		// 생략
}
```

- 애너테이션 설명
    - `@Id`: 해당 속성을 기본키로 지정함.
    - `@GeneratedValue`: 해당 속성에 값을 일일이 입력하지 않아도 자동으로 1씩 증가하여 저장함.
        - `strategy = GenerationType.IDENTITY`: 해당 속성만 별도로 번호가 차례대로 늘어남.
        - *참고*  - `strategy = GenerationType.IDENTITY`쓸 때 안 쓸 때 차이는 DB에 따라 다름
            - MySQL을 쓰면 `AUTO`나 `IDENTITY`나 사실상 **동일하게 동작**
            - Oracle/H2 같은 DB에서는 `AUTO`가 `SEQUENCE`를 쓰므로 성능 최적화 가능
    - `@Column`: 열의 세부 설정을 함. ex. length = 500
        - *참고* - 엔티티 속성은 `@Column`을 쓰지 않아도 테이블의 열로 인식하지만, 테이블의 열로 인식하고 싶지 않으면 `@Transient`을 사용하면 된다.
    - `@OneToMany(mappedBy = "review", cascade = CascadeType.REMOVE)` : foreign key 관계를 형성해줌. `cascade = CascadeType.REMOVE` 는 Review가 삭제될 때, 연관된 ReviewComment를 함께 삭제하게 함.
- 엔티티(자바 클래스)에서 속성명은 `reservedDate` 와 같이 카멜 케이스 형식으로 작성하고, 해당 속성명은 DB에서 `reserved_date` 라는 스네이크 케이스 형식으로 작명된다.
- 엔티티를 만들 때 Setter 메서드는 사용하지 않는 것을 권장한다. DB와 바로 연결되기때문에 생성자에 의해서만 엔티티의 값을 저장할 수 있게 하는 것이 좋음!!


---
Q. mappedBy가 의미하는 것이 정확히 뭘까?

Q. 교재에서는 Q&A 게시판을 만드느라 Question , Answer 엔티티를 1:N관계로 서로 참조하게 만들었다. 게다가 Question에 CascadeType.REMOVE를 추가하여 게시판 글에서 질문글이 삭제되면 딸려있는 답변들도 함께 삭제되도록 설계했다. 그렇다면, BE:OUR 프로젝트에서도 Space가 삭제되면 거기에 딸려있는 Like도 삭제되어야 하지 않을까?
